<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main menu</title>

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">
    <!-- Template Stylesheet -->
    <link href="/assets/css/styles.css" rel="stylesheet">
    <link href="/assets/css/styleMgtOrders.css" rel="stylesheet">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/assets/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/assets/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet"/>

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Template Stylesheet
    <link href="assets/css/style.css" rel="stylesheet"> -->
</head>

<body id="body-pd">
<div class="container-xxl position-relative bg-white d-flex p-0">
    <!-- Spinner Start -->
    <!-- <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="sr-only">Loading...</span>
  </div>
</div> -->


    <!-- Sidebar Start -->
    <div class="sidebar pe-4 pb-3">
        <nav class="navbar bg-light navbar-light">
            <a href="../home.html" class="navbar-brand mx-4 mb-3">
                <h3 class="text-primary"><i class="fa fa-truck me-2"></i>2Commerce</h3>
            </a>
            <div class="d-flex align-items-center ms-4 mb-4">
                <div class="position-relative">
                    <img class="rounded-circle" src="/images/TeamLogo.png" alt="" style="width: 40px; height: 40px;">
                    <div
                            class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
                    </div>
                </div>
                <div class="ms-3">
                    <h6 class="mb-0">관리자</h6>
                    <span>Admin</span>
                </div>
            </div>
            <div class="navbar-nav w-100">
                <a href="../home.html" class="nav-item nav-link active"><i
                        class="fa fa-tachometer-alt me-2"></i>Home</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                            class="fa fa-warehouse me-2"></i>창고관리</a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="/inventory/warehouselist" class="dropdown-item">창고조회</a>
                        <a href="typography.html" class="dropdown-item">창고등록</a>
                        <a href="element.html" class="dropdown-item">빼도됌</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                            class="fa fa-calculator me-2"></i>발주관리</a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="button.html" class="dropdown-item">발주등록</a>
                        <a href="typography.html" class="dropdown-item">발주확정</a>
                        <a href="element.html" class="dropdown-item">발주조회</a>
                        <a href="element.html" class="dropdown-item">발주대비미입고목록</a>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                                class="fa fa-cubes me-2"></i></i>재고관리</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="button.html" class="dropdown-item">재고조회</a>
                            <a href="typography.html" class="dropdown-item">미사용</a>
                            <a href="element.html" class="dropdown-item">미사용</a>
                        </div>

                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                                    class="fa fa-plus me-2"></i>입고관리</a>
                            <div class="dropdown-menu bg-transparent border-0">
                                <a href="signin.html" class="dropdown-item">입고조회</a>
                                <a href="signup.html" class="dropdown-item">미사용</a>
                                <a href="404.html" class="dropdown-item">미사용</a>
                                <a href="blank.html" class="dropdown-item">미사용</a>
                            </div>

                            <div class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                                        class="fa fa-minus me-2"></i>출고관리</a>
                                <div class="dropdown-menu bg-transparent border-0">
                                    <a href="signin.html" class="dropdown-item">출고조회</a>
                                    <a href="signup.html" class="dropdown-item">미사용</a>
                                    <a href="404.html" class="dropdown-item">미사용</a>
                                    <a href="blank.html" class="dropdown-item">미사용</a>
                                </div>
                            </div>

                            <div class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i
                                        class="fa fa-credit-card me-2"></i>주문관리</a>
                                <div class="dropdown-menu bg-transparent border-0">
                                    <a href="signin.html" class="dropdown-item">주문조회</a>
                                    <a href="signup.html" class="dropdown-item">주문수정</a>
                                    <a href="404.html" class="dropdown-item">주문최소</a>
                                    <a href="blank.html" class="dropdown-item">미사용</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
    <!-- Sidebar End -->


    <!-- Content Start -->
    <div class="content">
        <!-- Navbar Start -->
        <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
            <a href="../index.html" class="navbar-brand d-flex d-lg-none me-4">
                <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
            </a>
            <a href="#" class="sidebar-toggler flex-shrink-0">
                <i class="fa fa-bars"></i>
            </a>
            <form class="d-none d-md-flex ms-4">
                <input class="form-control border-0" type="search" placeholder="Search">
            </form>
            <div class="navbar-nav align-items-center ms-auto">
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-envelope me-lg-2"></i>
                        <span class="d-none d-lg-inline-flex">Message</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                        <a href="#" class="dropdown-item">
                            <div class="d-flex align-items-center">
                                <img class="rounded-circle" src="/images/user.png" alt=""
                                     style="width: 40px; height: 40px;">
                                <div class="ms-2">
                                    <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                    <small>15 minutes ago</small>
                                </div>
                            </div>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item">
                            <div class="d-flex align-items-center">
                                <img class="rounded-circle" src="/images/user.png" alt=""
                                     style="width: 40px; height: 40px;">
                                <div class="ms-2">
                                    <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                    <small>15 minutes ago</small>
                                </div>
                            </div>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item">
                            <div class="d-flex align-items-center">
                                <img class="rounded-circle" src="/images/user.png" alt=""
                                     style="width: 40px; height: 40px;">
                                <div class="ms-2">
                                    <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                    <small>15 minutes ago</small>
                                </div>
                            </div>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item text-center">See all message</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-bell me-lg-2"></i>
                        <span class="d-none d-lg-inline-flex">Notificatin</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                        <a href="#" class="dropdown-item">
                            <h6 class="fw-normal mb-0">Profile updated</h6>
                            <small>15 minutes ago</small>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item">
                            <h6 class="fw-normal mb-0">New user added</h6>
                            <small>15 minutes ago</small>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item">
                            <h6 class="fw-normal mb-0">Password changed</h6>
                            <small>15 minutes ago</small>
                        </a>
                        <hr class="dropdown-divider">
                        <a href="#" class="dropdown-item text-center">See all notifications</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        <img class="rounded-circle me-lg-2" src="/images/TeamLogo.png" alt=""
                             style="width: 40px; height: 40px;">
                        <span class="d-none d-lg-inline-flex" th:text="${id}">님!</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                        <a href="#" class="dropdown-item">My Profile</a>
                        <a href="#" class="dropdown-item">Settings</a>
                        <a href="/login/logout" class="dropdown-item" sec:authorize="isAuthenticated()">Log Out</a>
                        <a href="/login/login" class="dropdown-item" sec:authorize="isAnonymous()">Log in</a>
                    </div>
                </div>
            </div>
        </nav>
        <!-- Navbar End -->

        <!--        <div class="login-info">-->
        <!--            <p th:if="${#authorization.expression('isAuthenticated()')}">-->
        <!--                안녕하세요, <span th:text="${id}"></span>님! 역할: <span th:text='${role.substring(5)}'></span>-->
        <!--            </p>-->
        <!--        </div>-->

        <!--main contents Start-->


        <div class="row">
            <div class="col-sm-12" style="padding-right: 0">
                <div class="bg-light rounded h-30">
                    <h6 class="mb-4">발주등록</h6>
                    <div class="section top-section">
                        <form id="mgtOrderForm" action="/MgtOrders/MgtOrderCreate" method="post">
                            <div class="row">
                                <div>
                                    <label for="order-date-start">발주일자 * :</label>
                                    <input type="date" id="order-date-start" name="createdAt">
                                </div>
                                <div>
                                    <label for="order-id">발주번호 :</label>
                                    <input type="number" id="order-id" th:value="${id}" readonly>
                                    <input type="hidden" id="orderId" value="${id}">
                                </div>
                                <div>
                                    <label for="supplier">발주상태 :</label>
                                    <input type="text" id="status" value="READY" name="status" readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div>
                                    <label for="supplier">매입거래처 :</label>
                                    <input type="text" id="supplier" placeholder="Company" name="purchaser">
                                </div>
                                <div>
                                    <label for="warehouse">창고ID :</label>
                                    <input type="text" id="warehouse" placeholder="Warehouse 1" name="warehouseId">
                                </div>
                                <div></div>
                            </div>
                            <div class="button-row">
                                <!-- Check if id is present -->
                                <button class="btn btn-primary" type="submit" th:if="${id == null}">Create</button>
                                <!-- Disable the button if id is present -->
                                <button class="btn btn-primary" type="submit" th:if="${id != null}" disabled>Create</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div></div>
                <div class="bg-light rounded h-50 p-4">

                    <div class="section bottom-section">
                        <form id="addItems" action="/MgtOrders/AddItems" method="post">
                            <div class="input-fields">
                                <label for="item-name">상품번호:</label>
                                <input type="number" id="item-name" placeholder="상품번호 입력">
                                <label for="item-quantity">수량:</label>
                                <input type="number" id="item-quantity" placeholder="수량 입력">
                                <button class="btn btn-primary" type="button" id="addRowBtn">추가</button>
                            </div>
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th scope="col" style="background-color: #acd1ea;">No.</th>
                                    <th scope="col" style="background-color: #acd1ea;"><input type="checkbox" checked>
                                    </th>
                                    <th scope="col" style="background-color: #acd1ea;">Item</th>
                                    <th scope="col" style="background-color: #acd1ea;">Quantity</th>
                                </tr>
                                </thead>
                                <!--                        <tbody id="warehouse-data">-->
                                <!--                        </tbody>-->
                                <!--            아이템 테이블 리스트-->
                                <tbody id="table-body">

                                </tbody>
                            </table>
                            <div class="button-row">
                                <div>
                                    <button class="btn btn-primary" type="submit" onclick="showAlert()">Save</button>
                                </div>
                                <div>
                                    <button class="btn btn-primary" type="button" id="deleteBtn">Delete</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!--main contents End-->


        <!-- Footer Start -->
        <div class="container-fluid pt-4 px-4">
            <div class="bg-light rounded-top p-4">
                <div class="row">
                    <div class="col-12 col-sm-6 text-center text-sm-start">
                        &copy; <a href="#">2Commerce-Traning-Project by.2Commerce</a>, All Right Reserved.
                    </div>
                    <div class="col-12 col-sm-6 text-center text-sm-end">
                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        Designed By <a href="https://htmlcodex.com">2Commerce</a>
                        </br>
                        Distributed By <a class="border-bottom" href="https://themewagon.com"
                                          target="_blank">2Commerce</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->
    </div>
    <!-- Content End -->
</div>

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
</div>


<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/lib/chart/chart.min.js"></script>
<script src="/assets/lib/easing/easing.min.js"></script>
<script src="/assets/lib/waypoints/waypoints.min.js"></script>
<script src="/assets/lib/owlcarousel/owl.carousel.min.js"></script>
<!--<script src="/assets/lib/owlcarousel/owl.carousel.js/owl.carousel.min.js"></script>-->
<script src="/assets/lib/tempusdominus/js/moment.min.js"></script>
<script src="/assets/lib/tempusdominus/js/moment-timezone.min.js"></script>
<!--<script src="/assets/lib/tempusdominus/js/tempusdominus-bootstrap-4.js/tempusdominus-bootstrap-4.min.js"></script>-->
<script src="/assets/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Template Javascript -->
<script src="/assets/jsReal/main.js"></script>
<script th:inline="javascript">
    let rowCount = document.querySelectorAll('#table-body tr').length; // 초기 행 개수

    function addRow() {
        const itemName = document.getElementById('item-name').value;
        const itemQuantity = document.getElementById('item-quantity').value;

        if (itemName && itemQuantity) {
            const tableBody = document.getElementById('table-body');
            if (tableBody) {
                const newRow = document.createElement('tr');
                const tdNo = document.createElement('td');
                tdNo.textContent = ++rowCount;

                const tdCheckbox = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'checkedItems'; // Set the name for each checkbox
                checkbox.value = itemName + ',' + itemQuantity; // Set a value to identify the checked item
                tdCheckbox.appendChild(checkbox);

                const tdItem = document.createElement('td');
                tdItem.textContent = itemName;

                const tdQuantity = document.createElement('td');
                tdQuantity.textContent = itemQuantity;

                newRow.appendChild(tdNo);
                newRow.appendChild(tdCheckbox);
                newRow.appendChild(tdItem);
                newRow.appendChild(tdQuantity);

                tableBody.appendChild(newRow);
            }
            document.getElementById('item-name').value = '';
            document.getElementById('item-quantity').value = '';
        }
    }


    function deleteCheckedItems() {
        // Serialize the form data containing the checked checkboxes
        var formData = $('#addItems').serialize();

        // Send an AJAX request to the server to delete the selected rows
        $.ajax({
            url: '/MgtOrders/DeleteItems', // Update the endpoint accordingly
            type: 'POST',
            data: formData,
            success: function (response) {
                // Log the response from the server
                console.log('Response:', response);

                // Check if the response indicates successful deletion
                if (response === 'Items deleted successfully') {
                    // Iterate over the checked checkboxes and remove their parent rows
                    $('#table-body input[type="checkbox"]:checked').each(function () {
                        $(this).closest('tr').remove();
                    });

                    // Log a message indicating successful deletion
                    console.log('Selected rows deleted successfully');

                    // You can update the UI or perform any other actions here
                } else {
                    // Log an error message if deletion was unsuccessful
                    console.error('Failed to delete selected rows:', response);
                    // You can handle the error or inform the user accordingly
                }
            },
            error: function (xhr, status, error) {
                // Handle any errors
                console.error('Error:', error);
            }
        });
    }

    $('#addItems').submit(function (event) {
        event.preventDefault(); // Prevent the default form submission

        var checkedItems = [];

        $('#table-body tr').each(function (index, row) {
            var checkbox = $(row).find('input[type="checkbox"]');
            if (checkbox.is(':checked')) {
                var values = checkbox.val().split(','); // Split value into itemName and quantity
                var itemName = values[0];
                var quantity = values[1];

                checkedItems.push({itemName: itemName, quantity: quantity});
            }
        });

        var idValue = $('#order-id').val();
        console.log(idValue);
        var requestData = {
            checkedItems: checkedItems,
            id: idValue
        };
        console.log(requestData);

        // var idValue = [[${id}]];

        // Send JSON data to server using Ajax
        $.ajax({
            url: '/MgtOrders/AddItems',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(requestData),
            success: function (response) {
                console.log("response id : " + response.id);
                console.log('Data submitted successfully');
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            }
        });
    });

    // 추가 버튼 클릭 이벤트 바인딩
    document.getElementById('addRowBtn').addEventListener('click', addRow);

    document.getElementById('deleteBtn').addEventListener('click', function (event) {
        // Prevent the default click behavior
        event.preventDefault();

        // Call the function to delete checked items
        deleteCheckedItems();
    });

    function showAlert() {
        alert("저장되었습니다!");
    }


</script>

<script>


        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('mgtOrderForm').addEventListener('submit', function (event) {
                event.preventDefault(); // Prevent default form submission

                // Get form data
                var formData = {
                    createdAt: document.getElementById('order-date-start').value + "T00:00", // YYYY-MM-DD 형식으로 변환
                    purchaser: document.getElementById('supplier').value,
                    status: document.getElementById('status').value,
                    warehouseId: document.getElementById('warehouse').value
                };

                // Convert form data to JSON
                var jsonData = JSON.stringify(formData);

                // Send AJAX request
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/MgtOrders/MgtOrderCreate');
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function () {
                    if (xhr.status === 200) {
                        // Handle success response
                        var response = JSON.parse(xhr.responseText);
                        console.log(response); // Log response to console
                        // Optionally, update UI or redirect to another page
                        // Check if the response contains the order ID
                        if (response.id) {
                            // Update the UI to display the order ID
                            document.getElementById('order-id').value = response.id;
                        } else {
                            console.error('Order ID not found in the response');
                        }
                    } else {
                        // Handle error response
                        console.error('Request failed with status:', xhr.status);
                    }
                };
                xhr.send(jsonData);
            });
        });
</script>
</body>

</html>